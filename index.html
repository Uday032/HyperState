<!doctype html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"
        integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <title>Hyperstate Internship Task</title>
</head>

<body>
    <div class="container">
        <section style="padding-top: 4rem;">
            <div class="row">
                <div class="col-3">
                    <div class="nav flex-column nav-pills" id="v-pills-tab" role="tablist" aria-orientation="vertical">
                        <a class="nav-link active" id="v-pills-home-tab" data-toggle="pill" href="#v-pills-home"
                            role="tab" aria-controls="v-pills-home" aria-selected="true">Upload Image</a>
                        <a class="nav-link" id="v-pills-profile-tab" data-toggle="pill" href="#v-pills-profile"
                            role="tab" aria-controls="v-pills-profile" aria-selected="false">Upload Video</a>
                        <a class="nav-link" id="v-pills-profile-tab" data-toggle="pill" href="#v-pills-get"
                            role="tab" aria-controls="v-pills-profile" aria-selected="false">Get and Delete Data</a>
                    </div>
                </div>
                <div class="col-9">
                    <div class="tab-content" id="v-pills-tabContent">
                        <div class="tab-pane fade show active" id="v-pills-home" role="tabpanel"
                            aria-labelledby="v-pills-home-tab">
                            <h2>Upload Image</h2>
                            <form method="POST" action="" enctype="multipart/form-data">
                                <div class="mt-4">
                                    <div>
                                        <input type="file" multiple id="input-multi-files" name="multiple_images" class="
                                            form-control-file">
                                    </div>
                                    <div class="mt-4 mb-4">
                                        <h4 class="uploading-status"></h4>
                                    </div>
                                    
                                    <div class="mt-2">
                                        <button type="submit" id="upload-images-submit-button" class="btn btn-primary">
                                            Submit</button>
                                    </div>
                                    <div class="mt-6">
                                        <div>
                                            <div class="preview-images"></div>
                                        </div>
                                    </div>
                                </div>
                            </form>
                        </div>
                        <div class="tab-pane fade" id="v-pills-profile" role="tabpanel"
                            aria-labelledby="v-pills-profile-tab">
                            <h2>Upload Video</h2>
                            <form method="POST" action="/upload-videos" enctype="multipart/form-data"></form>
                                <div class="mt-4">
                                    <input type="file" multiple id="input-multi-videos" name="multiple_videos" class="
                                                form-control-file">
                                </div>
                                <div class="mt-4 mb-4">
                                    <h4 class="video-uploading-status"></h4>
                                </div>

                                <div class="mt-2">
                                    <button type="submit" id="upload-video-submit-button" class="btn btn-primary">
                                        Submit</button>
                                </div>
                            </form>
                        </div>
                        <div class="tab-pane fade" id="v-pills-get" role="tabpanel"
                            aria-labelledby="v-pills-profile-tab">
                            <h2>Get and Delete Photos and Videos</h2>

                            <ul class="nav nav-pills mb-3" id="pills-tab" role="tablist">
                                <li class="nav-item">
                                    <a class="nav-link image-pill" id="pills-image-tab" data-toggle="pill" href="#pills-home"
                                        role="tab" aria-controls="pills-image" aria-selected="true">Get Image</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" id="pills-video-tab" data-toggle="pill" href="#pills-video"
                                        role="tab" aria-controls="pills-video" aria-selected="false">Get Videos</a>
                                </li>
                                <!-- <li class="nav-item">
                                    <a class="nav-link" id="pills-contact-tab" data-toggle="pill" href="#pills-contact"
                                        role="tab" aria-controls="pills-contact" aria-selected="false">Contact</a>
                                </li> -->
                            </ul>
                            <div class="tab-content" id="pills-tabContent">
                                <div class="tab-pane fade show active" id="pills-image" role="tabpanel"
                                    aria-labelledby="pills-image-tab"></div>
                                <div class="tab-pane fade" id="pills-video" role="tabpanel"
                                    aria-labelledby="pills-video-tab"></div>
                                <!-- <div class="tab-pane fade" id="pills-contact" role="tabpanel"
                                    aria-labelledby="pills-contact-tab">...</div> -->
                            </div>


                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>


    <!-- Optional JavaScript; choose one of the two! -->

    <!-- Option 1: jQuery and Bootstrap Bundle (includes Popper) -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"
        integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous">
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx" crossorigin="anonymous">
    </script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <!-- Option 2: jQuery, Popper.js, and Bootstrap JS
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.min.js" integrity="sha384-w1Q4orYjBQndcko6MimVbzY0tgp4pWB4lZ7lr30WKz0vr/aWKhXdBNmNb5D92v7s" crossorigin="anonymous"></script>
    -->

     <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
     <script>
         $(document).ready(function () {
             let imagesPreview = function (input, placeToInsertImagePreview) {
                 if (input.files) {
                     let filesAmount = input.files.length;
                     for (i = 0; i < filesAmount; i++) {
                         let reader = new FileReader();
                         reader.onload = function (event) {
                             $($.parseHTML("<img>"))
                                 .attr("src", event.target.result)
                                 .appendTo(placeToInsertImagePreview);
                         };
                         reader.readAsDataURL(input.files[i]);
                     }
                 }
             };
             $("#input-multi-files").on("change", function () {
                 imagesPreview(this, "div.preview-images");
             });
         });

        $("#upload-images-submit-button").click(function(e) {
            e.preventDefault();
            var this_ = $(this)
            $("#upload-images-submit-button").addClass("disabled")
            $(".uploading-status").text("uploading")
            // console.log($("#input-multi-files").val());

            var form_data = new FormData();

            // Read selected files
            var totalfiles = document.getElementById('input-multi-files').files.length;

            for (var index = 0; index < totalfiles; index++) { 
                form_data.append("multiple_images", document.getElementById('input-multi-files').files[index]);
                // console.log(document.getElementById('input-multi-files').files[index]);
            }
            // form_data.append('multiple_images', document.getElementById('input-multi-files').files)
            // console.log(document.getElementById('input-multi-files').files);
            $.ajax({
                url: "/upload-images",
                method: "POST",
                data: form_data,
                processData: false,
                contentType: false,
                success: function(data){
                    $(".uploading-status").text("Uploaded");
                    console.log(data);
                    console.log("inside success");
                    $("#upload-images-submit-button").removeClass("disabled")
                }, 
                error: function(xhr,errmsg,err) {
                    console.log(xhr.status + ": " + xhr.responseText);
                }
            })
            
        });

        $("#upload-video-submit-button").click(function(e){
            e.preventDefault();
            var this_ = $(this);
            $("#upload-video-submit-button").addClass("disabled")
            $(".video-uploading-status").text("uploading");
           
            var video_form_data = new FormData();

            var totalvideofiles = document.getElementById('input-multi-videos').files.length;

            for (var index = 0; index < totalvideofiles; index++) { 
                video_form_data.append("multiple_videos", document.getElementById('input-multi-videos').files[index]);
                //
                // console.log(document.getElementById('input-multi-files').files[index]); 
            }

            $.ajax({
                url: "/upload-videos",
                method: "POST",
                data: video_form_data,
                processData: false,
                contentType: false,
                success: function(data){
                    $(".video-uploading-status").text("Uploaded");
                    console.log(data);
                    console.log("inside success");
                    $("#upload-video-submit-button").removeClass("disabled")
                }, 
                error: function(xhr,errmsg,err) {
                    console.log(xhr.status + ": " + xhr.responseText);
                }
            })
        });

        //show uploaded images
        $(".image-pill").click(function(e){
            e.preventDefault();
            $.ajax({
                url: '/displayimages',
                method: "GET",
                success: function(data){
                    console.log(data);
                    console.log("inserted", data.length, data[0]);
                    var imagedata = ""
                    for(var i=0; i<data.length;i++){
                        imagedata = imagedata+ '<img src=./images/'+data[i]+' width="300" style="margin: 15px">'
                    }
                    $("#pills-image").html(imagedata);
                    console.log("Inserted");
                    // console.log("inserted", imagedata.length);
                },
                error: function(xhr,errmsg,err) {
                    console.log(xhr.status + ": " + xhr.responseText);
                }
            });
        });

        //show uploaded videos
        $("#pills-video-tab").click(function(e){
            e.preventDefault();
            $.ajax({
                url: '/displayvideos',
                method: "GET",
                success: function(data){
                    console.log(data);
                    console.log("inserted", data.length, data[0]);
                    var videodata = ""
                    for(var i=0; i<data.length;i++){
                        videodata = videodata+ '<video width="320" height="240"  style="margin: 10px" controls> <source src=/videos/'+data[i]
                                            + '></video>'
                    }
                    $("#pills-video").html(videodata);
                    // console.log("inserted", videodata.length);
                },
                error: function(xhr,errmsg,err) {
                    console.log(xhr.status + ": " + xhr.responseText);
                }
            })
        })
     </script>
</body>

</html>